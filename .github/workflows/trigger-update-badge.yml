#################################################################################
#  Copyright (c) 2025 Bayerische Motoren Werke Aktiengesellschaft (BMW AG)
#
#  See the NOTICE file(s) distributed with this work for additional
#  information regarding copyright ownership.
#
#  This program and the accompanying materials are made available under the
#  terms of the Apache License, Version 2.0 which is available at
#  https://www.apache.org/licenses/LICENSE-2.0.
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
#  WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
#  License for the specific language governing permissions and limitations
#  under the License.
#
#  SPDX-License-Identifier: Apache-2.0
#################################################################################


---
name: trigger-update-badge.yml
on:
  workflow_dispatch:
    inputs:
      version:
        required: true
        description: 'a semver string denoting the version'
      update-badge:
        type: string
        required: false
        description: 'notEmpty if is a versioned snapshot'
  workflow_call:
    inputs:
      version:
        type: string
        required: true
        description: 'a semver string denoting the version'
      update-badge:
        type: string
        required: false
        description: 'notEmpty if is a versioned snapshot'
jobs:
  update-snapshot-badge:
    name: 'Update Snapshot badge in README.md'
    permissions:
      contents: write
    runs-on: ubuntu-latest
    steps:
      - name: Check for updated version
        run: |
          UPDATE_BADGE="${{ inputs.update-badge }}"
          if [[ -z "$UPDATE_BADGE" ]]; then
              echo "No badge update requested, skipping."
              exit 0
          fi
          VERSION="${{ inputs.version }}"
          ESCAPED_VERSION="${VERSION//-/--}"
          echo "Determined version: $VERSION (escaped: $ESCAPED_VERSION)"
        uses: schneegans/dynamic-badges-action@v1.7.0
        with:
          auth: ${{ secrets.GIST }}
          gistID: <261806a981f7a130e63e628a377d93be>
          filename: latest_version.json
          label: $ESCAPED_VERSION
          message: "Update snapshot badge to $VERSION"